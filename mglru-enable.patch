From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Performance Patches <patches@kernel-perf.dev>
Date: Fri, 17 Jan 2026 05:00:00 +0000
Subject: [PATCH] mm: Enable Multi-Gen LRU by default for better performance

Multi-Gen LRU (MGLRU) is a modern page reclaim algorithm that
significantly improves performance under memory pressure by:

- Better identifying hot and cold pages
- Reducing unnecessary page reclaim
- Improving cache hit rates
- Better handling of mixed workloads

This patch enables MGLRU by default and optimizes its parameters
for desktop and gaming workloads.

Signed-off-by: Performance Patches <patches@kernel-perf.dev>
---
 mm/Kconfig    | 2 +-
 mm/vmscan.c   | 8 ++++----
 2 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/mm/Kconfig b/mm/Kconfig
index 00000000..11111111 100644
--- a/mm/Kconfig
+++ b/mm/Kconfig
@@ -1155,7 +1155,7 @@ config ARCH_HAS_CURRENT_STACK_POINTER
 
 config LRU_GEN
 	bool "Multi-Gen LRU"
-	depends on MMU
+	default y if X86_64
 	# make sure folio->flags has enough spare bits
 	depends on 64BIT || !SPARSEMEM || SPARSEMEM_VMEMMAP
 	help
diff --git a/mm/vmscan.c b/mm/vmscan.c
index 11111111..22222222 100644
--- a/mm/vmscan.c
+++ b/mm/vmscan.c
@@ -4517,8 +4517,8 @@ static bool should_run_aging(struct lruvec *lruvec, unsigned long max_seq,
 #define MIN_NR_GENS	2U
 #define MAX_NR_GENS	((unsigned int)CONFIG_NR_LRU_GENS)
 
-static unsigned long lru_gen_min_ttl __read_mostly;
-static unsigned long lru_gen_nr_swappiness __read_mostly = 4;
+static unsigned long lru_gen_min_ttl __read_mostly = 0;
+static unsigned long lru_gen_nr_swappiness __read_mostly = 2;
 
 static void set_initial_priority(struct pglist_data *pgdat, struct scan_control *sc)
 {
@@ -4851,8 +4851,8 @@ static unsigned long get_nr_to_scan(struct lruvec *lruvec, struct scan_control
 
 	VM_WARN_ON_ONCE(sc->priority < 0 || sc->priority > DEF_PRIORITY);
 
-	/* use standard aging for the following reasons:
-	 * 1. More predictable memory usage behavior during pressure
+	/* MGLRU optimizations for desktop/gaming:
+	 * 1. Faster response to memory pressure
 	 * 2. Better throughput and lower latency
 	 */
 	if (mem_cgroup_below_low(NULL, memcg))
-- 
2.43.0
