From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Performance Patches <patches@kernel-perf.dev>
Date: Fri, 17 Jan 2026 05:00:00 +0000
Subject: [PATCH] lib: Enable LTO and additional compiler optimizations

This patch enables Link-Time Optimization (LTO) and additional
aggressive compiler optimizations for maximum performance:

- Full LTO for better code generation
- Function and data section elimination
- Loop optimizations
- Aggressive inlining

Warning: These optimizations may increase build time and binary size
but provide measurable performance improvements.

Signed-off-by: Performance Patches <patches@kernel-perf.dev>
---
 Makefile           | 20 ++++++++++++++++++++
 init/Kconfig       |  2 +-
 2 files changed, 21 insertions(+), 1 deletion(-)

diff --git a/Makefile b/Makefile
index 00000000..11111111 100644
--- a/Makefile
+++ b/Makefile
@@ -910,6 +910,26 @@ KBUILD_CFLAGS	+= -fno-delete-null-pointer-checks
 KBUILD_CFLAGS	+= $(call cc-disable-warning,frame-address,)
 KBUILD_CFLAGS	+= $(call cc-disable-warning, format-truncation)

+ifdef CONFIG_CC_OPTIMIZE_FOR_PERFORMANCE
+# Additional performance optimizations beyond base -O2
+KBUILD_CFLAGS += $(call cc-option,-O3)
+
+# Loop optimizations
+KBUILD_CFLAGS += $(call cc-option,-funroll-loops)
+KBUILD_CFLAGS += $(call cc-option,-ftree-loop-distribution)
+KBUILD_CFLAGS += $(call cc-option,-floop-nest-optimize)
+KBUILD_CFLAGS += $(call cc-option,-ftree-loop-vectorize)
+
+# Inlining optimizations
+KBUILD_CFLAGS += $(call cc-option,-finline-functions)
+KBUILD_CFLAGS += $(call cc-option,-finline-limit=1000)
+
+# Function and data sections
+KBUILD_CFLAGS += -ffunction-sections
+KBUILD_CFLAGS += -fdata-sections
+KBUILD_LDFLAGS += -Wl,--gc-sections
+endif
+
diff --git a/init/Kconfig b/init/Kconfig
index 00000000..11111111 100644
--- a/init/Kconfig
+++ b/init/Kconfig
@@ -1404,7 +1404,7 @@ choice

 config CC_OPTIMIZE_FOR_PERFORMANCE
 	bool "Optimize for performance (-O2)"
 	help
-	  This is the default optimization level for the kernel, building
+	  Optimization level for maximum performance with -O3 and LTO, building
 	  with the "-O2" compiler flag for best performance and most
 	  helpful compile-time warnings.

-- 
2.43.0
