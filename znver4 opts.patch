From d311f8f3c0a6e9a9876543210fedcba98765434 Mon Sep 17 00:00:00 2001
From: Ryan J Manzo <ryan.j.manzo@gmail.com>
Date: Wed, 15 Jan 2026 00:00:00 +0000
Subject: [PATCH] Ultimate MAX PERFORMANCE + PGO/AutoFDO + extra GCC flags for Ryzen 5 7600X

---
 arch/x86/Makefile | 35 +++++++++++++++++++++++++++++++++++
 1 file changed, 35 insertions(+)

diff --git a/arch/x86/Makefile b/arch/x86/Makefile
index 1a27efcf3c20..abcdef987656 100644
--- a/arch/x86/Makefile
+++ b/arch/x86/Makefile
@@
+# ULTIMATE MAX PERFORMANCE FLAGS FOR RYZEN 5 7600X / ZEN4 + PGO/AutoFDO + extras
+ifdef CONFIG_CC_OPTIMIZE_FOR_PERFORMANCE
+KBUILD_CFLAGS += -O3 -Ofast -flto=full \
+    -march=znver4 -mtune=znver4 \
+    -fomit-frame-pointer -fno-stack-protector -fno-strict-aliasing \
+    -ffast-math -funroll-loops -funroll-all-loops -fprefetch-loop-arrays \
+    -funit-at-a-time -fmerge-all-constants -ffunction-sections -fdata-sections \
+    -fno-builtin -fno-common -floop-interchange -floop-strip-mine -floop-block \
+    -fpeel-loops -fpredictive-commoning -fweb -frename-registers -faggressive-loop-optimizations \
+    -ftree-vectorize -fipa-sra -fipa-cp -fstrict-overflow -fno-optimize-sibling-calls \
+    -mavx2 -mavx -mfma -mfma4 -mbmi -mbmi2 -madx -msha -mf16c -mfp16 -mrdseed -mclzero -mwaitx -mabm \
+    -mxsaveopt -mxsavec -mxsave -mavx512f -mavx512dq -mavx512vl -mavx512bw \
+    -mfsgsbase -mclflushopt -fipa-cp-clone -fipa-pta
+
+# Rust kernel optimization
+KBUILD_RUSTFLAGS += -Copt-level=3
+
+# Enable PGO / AutoFDO if supported
+ifdef CONFIG_PGO_KERNEL
+KBUILD_CFLAGS += -fprofile-generate -fcallgraph-profile
+endif
+
+endif
+
-- 
2.47.2
